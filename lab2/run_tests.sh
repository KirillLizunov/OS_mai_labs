#!/bin/bash

# Массив с количеством потоков
threads=(1 2 4 6 8 10 12)

# Проверяем, был ли передан аргумент с количеством переменных
if [ -z "$1" ]; then
    echo "Ошибка: не указано количество переменных."
    echo "Использование: $0 <количество переменных>"
    exit 1
fi

# Количество переменных передаем как первый аргумент
num_variables=$1

# Массив для хранения времени выполнения
times=()

# Процесс запуска программы для каждого значения количества потоков
for t in "${threads[@]}"
do
    # Запускаем программу и сохраняем результат
    result=$(echo -e "$num_variables\n2" | ./main $t)

    # Извлекаем время выполнения (ищем строку с "Время выполнения")
    time_spent=$(echo "$result" | grep 'Время выполнения' | awk '{print $3}')

    # Если время не найдено, устанавливаем N/A
    if [ -z "$time_spent" ]; then
        time_spent="N/A"
    fi

    # Выводим время выполнения для текущего количества потоков
    echo "Количество потоков: $t, Время: $time_spent секунд"

    # Добавляем время в массив
    times+=("$time_spent")
done

# Формируем строку с запятыми и выводим
times_str=$(IFS=,; echo "${times[*]}")
echo "[$times_str]"
